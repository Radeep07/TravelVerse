var map,markers,bounds,ATTR_API_KEY="5ae2e3f221c38a28845f05b6539092183be7af15887fd47cb35ed3ff",ATTR_API_URL="https://api.opentripmap.com/0.1/en/places/radius",places=[];function initAutocomplete(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:-33.8688,lng:151.2195},zoom:13,mapTypeControl:!1,disableDefaultUI:!0,mapTypeId:"roadmap"});var e=document.getElementById("pac-input"),t=new google.maps.places.SearchBox(e);map.controls[google.maps.ControlPosition.TOP_LEFT].push(e),map.addListener("bounds_changed",function(){t.setBounds(map.getBounds())}),markers=[],t.addListener("places_changed",function(){0!=(places=t.getPlaces()).length&&(markers.forEach(function(e){e.setMap(null)}),markers=[],bounds=new google.maps.LatLngBounds,places.forEach(function(e){if(e.geometry){var t=new google.maps.Marker({map:map,title:e.name,position:e.geometry.location}),a=new google.maps.InfoWindow;google.maps.event.addListener(t,"click",function(e,t,a){return function(){a.setContent("<div><strong>"+t.name+"</strong>"),a.open(map,e)}}(t,e,a)),markers.push(t),getAttraction(e)}else console.log("Returned place contains no geometry")}))})}function createMarkers(e){for(var t=0;t<e.length;t++){var a=e[t];if(a.name){var o={path:fontawesome.markers.MAP_PIN,scale:.3,strokeWeight:.2,strokeColor:"black",strokeOpacity:1,fillColor:"#f8ae5f",fillOpacity:.9},n=new google.maps.LatLng(parseFloat(a.point.lat),parseFloat(a.point.lon)),r=new google.maps.Marker({map:map,icon:o,title:a.name,position:n}),s=new google.maps.InfoWindow;google.maps.event.addListener(r,"click",function(e,t,a){return function(){for(var o,n=t.rate?t.rate:0,r="",s=0;s<n;s++)r+="<img src='../images/star.png'></img>";o=t.dist<1e3?parseFloat(t.dist).toFixed(2)+"m":(parseFloat(t.dist)/1e3).toFixed(2)+"km",a.setContent("<div><strong>"+t.name+"</strong><br>Distance: "+o+"<br>"+r),a.open(map,e)}}(r,a,s)),markers.push(r),bounds.extend(r.getPosition())}}map.setCenter(bounds.getCenter()),map.fitBounds(bounds),map.setZoom(map.getZoom()+1)}function createAttractionCard(e){for(var t=$("#attraction-cards"),a=$(),o=0;o<e.length;o++){var n=e[o];if(n.name){for(var r=n.kinds.split(",").join(", "),s=n.rate?n.rate:0,i="",c=0;c<s;c++)i+="<img src='../images/star.png'></img>";a=a.add(`<div class="column is-one-quarter"><div class="card"><div class="card-content">\n        <p class="title is-4">${n.name}</p>\n        ${i}\n        <div class="content">Type: ${r}</div>\n      </div></div></div>`)}}t.html(a)}function getAttraction(e){const t=e.geometry.location.lat(),a=e.geometry.location.lng();let o=ATTR_API_URL+"?radius=5000&lon="+a+"&lat="+t+"&format=json&apikey="+ATTR_API_KEY;$.ajax({url:o,method:"GET"}).then(function(e){createMarkers(e),createAttractionCard(e)})}